# 📝 Chrome拡張機能 要件定義書：YouTube Timestamped Notes

## 🎯 目的

YouTube動画の視聴中に重要なポイントを**タイムスタンプ付きで記録**し、記録したメモから**動画の特定時点にすぐにジャンプ**できるようにすることで、学習・リサーチ効率を向上させる。

## ⚙️ 機能の全体像 (High-Level Overview)

| No. | 機能名 | 概要 | 実装場所 |
| :--- | :--- | :--- | :--- |
| 1 | **メモの作成・保存** | 拡張機能のポップアップから、現在の動画ID、再生時間、動画タイトル、メモを保存する。 | Popup / Content Script / Storage |
| 2 | **ページ内メモ表示** | 動画視聴ページ上に、その動画に紐づくメモの一覧を表示する。 | Content Script |
| 3 | **ページ内ジャンプ** | ページ内のメモをクリックすると、動画を指定の秒数まで移動させる。 | Content Script |
| 4 | **グローバルメモ一覧** | **オプションページ**として全動画のメモ一覧を表示し、そこから動画に直接ジャンプさせる。 | Options Page / Storage / Tabs API |
| 5 | **データ永続化** | 全てのメモデータをブラウザのローカルストレージに永続的に保存する。 | Storage API |

## 💻 技術的要件とファイル構成

### 1. manifest.json (マニフェストファイル)

| 設定項目 | 内容 | 備考 |
| :--- | :--- | :--- |
| `name` | **YouTube Timestamped Notes** | アプリ名として使用。 |
| `manifest_version` | 3 | Chrome Manifest V3 を使用。 |
| `permissions` | `storage`, `tabs` | データの保存、タブの操作（新規タブでの動画再生）に必要。 |
| `host_permissions` | `*://www.youtube.com/*` | YouTubeページでContent Scriptを動作させるため。 |
| `action` | `default_popup: "popup.html"` | アイコンクリック時にポップアップを表示。 |
| `content_scripts` | `content.js` | `www.youtube.com/watch` ページでのみ動作させる。 |
| `options_page` | `"options.html"` | 全てのメモを一元管理するページ。 |
| `background` | `service_worker: "background.js"` | メッセージ処理用。 |

### 2. popup.html / popup.js (UIおよびメモ保存ロジック)

#### **ロジック要件 (popup.js)**

1.  **現在のタブ情報の取得:** アクティブなタブがYouTube動画ページ（`/watch`）であることを確認する。
2.  **再生時間・動画ID・タイトルの要求:** Content Script (`content.js`) に対して、現在の再生時間、動画ID、および**動画のタイトル**の取得を要求する。
3.  **メモの保存:**
    * Content Scriptからの情報とユーザーの入力テキストを取得。
    * `chrome.storage.local.set` を使用し、以下のデータ構造で保存する。

### 3. content.js (YouTubeページでの操作・表示)

#### **ロジック要件**

1.  **情報提供:** Popupからの要求を受け取ったら、以下の情報をPopupに返信する。
    * `currentTime` (再生時間・秒)
    * `videoId` (URLから抽出)
    * `videoTitle` (`document.title` から抽出)
2.  **メモリストの描画:**
    * `chrome.storage.local` から現在の動画IDに紐づくメモを取得し、動画プレーヤーの近く（例：動画説明欄の上）にカスタムUIとして表示する。
3.  **ジャンプ機能（ページ内）:**
    * 表示されたメモのタイムスタンプがクリックされたら、`video.currentTime = [秒数]` を実行し、動画の再生位置を移動させる。

### 4. options.html / options.js (グローバルメモ一覧機能)

#### **UI要件 (options.html)**

* 全てのメモを一覧表示するためのシンプルなテーブルまたはリスト。
* 各メモには、「動画タイトル」「タイムスタンプ」「メモ内容」を含める。
* 各行にジャンプ用のリンク/ボタンを設置する。

#### **ロジック要件 (options.js)**

1.  **全メモの取得:** `chrome.storage.local.get(null)` を使用し、全ての動画IDに紐づく全てのメモデータを取得する。
2.  **一覧のレンダリング:** 取得したデータを整形し、テーブルとして描画する。
3.  **ジャンプ機能（グローバル）:**
    * メモのリンク/ボタンがクリックされたら、以下の形式でURLを生成する。
        * `const url = \`https://www.youtube.com/watch?v=${videoId}&t=${time}s\`;`
    * `chrome.tabs.create({ url: url })` を使用し、**新しいタブで**動画を指定の秒数から再生させる。

## 💾 データ構造 (Storage Format)

`chrome.storage.local` には、動画IDをキーとして、以下の構造でデータを保存する。

```javascript
{
  // Key: 動画ID (例: "dQw4w9WgXcQ")
  "VIDEO_ID_HERE": {
      "title": "保存時の動画タイトル",
      "notes": [
          {
            "time": 120,          // 秒単位の再生時間
            "text": "重要な概念の定義",
            "timestamp_text": "02:00" // 表示用の整形された時刻
          },
          // ...他のメモ
      ]
  },
  // 他の動画のキーが続く...
}